<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0a0f1e">
<title>Landlord Leads</title>
<link rel="manifest" href="manifest.json">
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --gold: #c8a96e;
  --gold-light: #e8c98e;
  --navy: #0a0f1e;
  --navy-mid: #131929;
  --navy-card: #1a2235;
  --navy-border: #243050;
  --text: #e8eaf0;
  --text-muted: #8892aa;
  --green: #4caf7d;
  --amber: #f5a623;
  --red: #e05c5c;
  --blue: #5b8cef;
  --purple: #9b6ef5;
  --safe-top: env(safe-area-inset-top, 0px);
  --safe-bottom: env(safe-area-inset-bottom, 0px);
}

* { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }

html, body {
  height: 100%;
  background: var(--navy);
  color: var(--text);
  font-family: 'DM Sans', sans-serif;
  font-size: 15px;
  overflow: hidden;
}

/* ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ */
#app { display: flex; flex-direction: column; height: 100vh; height: 100dvh; }

.top-bar {
  padding: calc(var(--safe-top) + 12px) 20px 12px;
  background: var(--navy);
  border-bottom: 1px solid var(--navy-border);
  flex-shrink: 0;
  z-index: 10;
}

.top-bar-inner { display: flex; align-items: center; justify-content: space-between; }
.app-title { font-family: 'DM Serif Display', serif; font-size: 22px; color: var(--gold); letter-spacing: 0.3px; }
.app-subtitle { font-size: 11px; color: var(--text-muted); margin-top: 1px; }

.tab-bar {
  display: flex;
  background: var(--navy);
  border-top: 1px solid var(--navy-border);
  padding-bottom: var(--safe-bottom);
  flex-shrink: 0;
}

.tab-btn {
  flex: 1; display: flex; flex-direction: column; align-items: center; gap: 3px;
  padding: 10px 4px; border: none; background: transparent; color: var(--text-muted);
  font-family: 'DM Sans', sans-serif; font-size: 10px; font-weight: 500;
  cursor: pointer; transition: color 0.2s; letter-spacing: 0.3px; text-transform: uppercase;
}
.tab-btn.active { color: var(--gold); }
.tab-btn svg { width: 22px; height: 22px; }
.tab-indicator { width: 4px; height: 4px; border-radius: 2px; background: var(--gold); opacity: 0; transition: opacity 0.2s; margin-top: 2px; }
.tab-btn.active .tab-indicator { opacity: 1; }

.screen { display: none; flex: 1; overflow-y: auto; overflow-x: hidden; }
.screen.active { display: flex; flex-direction: column; }

/* ‚îÄ‚îÄ SCROLL ‚îÄ‚îÄ */
::-webkit-scrollbar { width: 0; }

/* ‚îÄ‚îÄ DASHBOARD ‚îÄ‚îÄ */
.dash-header { padding: 20px 20px 8px; }
.greeting { font-size: 13px; color: var(--text-muted); }
.greeting strong { color: var(--gold); }

.stats-grid {
  display: grid; grid-template-columns: 1fr 1fr;
  gap: 12px; padding: 12px 20px;
}
.stat-card {
  background: var(--navy-card); border: 1px solid var(--navy-border);
  border-radius: 14px; padding: 16px; position: relative; overflow: hidden;
}
.stat-card::before {
  content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px;
  background: var(--accent-color, var(--gold));
}
.stat-label { font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; }
.stat-value { font-family: 'DM Serif Display', serif; font-size: 32px; color: var(--text); margin-top: 4px; line-height: 1; }
.stat-sub { font-size: 11px; color: var(--text-muted); margin-top: 4px; }

.section-header { padding: 16px 20px 8px; display: flex; align-items: center; justify-content: space-between; }
.section-title { font-size: 13px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.8px; color: var(--text-muted); }
.section-link { font-size: 12px; color: var(--gold); }

.followup-list { padding: 0 20px 20px; display: flex; flex-direction: column; gap: 8px; }

.followup-card {
  background: var(--navy-card); border: 1px solid var(--navy-border);
  border-radius: 12px; padding: 14px 16px;
  display: flex; align-items: center; gap: 12px;
  cursor: pointer; transition: border-color 0.2s;
}
.followup-card:active { border-color: var(--gold); }
.followup-avatar {
  width: 40px; height: 40px; border-radius: 50%; background: var(--navy-border);
  display: flex; align-items: center; justify-content: center;
  font-family: 'DM Serif Display', serif; font-size: 16px; color: var(--gold);
  flex-shrink: 0;
}
.followup-info { flex: 1; min-width: 0; }
.followup-name { font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.followup-meta { font-size: 12px; color: var(--text-muted); margin-top: 2px; }
.followup-due { font-size: 11px; font-weight: 600; letter-spacing: 0.3px; }
.due-today { color: var(--amber); }
.due-overdue { color: var(--red); }
.due-upcoming { color: var(--text-muted); }

.empty-state { padding: 40px 20px; text-align: center; color: var(--text-muted); }
.empty-state .icon { font-size: 40px; margin-bottom: 12px; }
.empty-state p { font-size: 13px; }

/* ‚îÄ‚îÄ LEADS LIST ‚îÄ‚îÄ */
.search-bar { padding: 12px 20px; }
.search-input-wrap { position: relative; }
.search-input-wrap svg { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--text-muted); width: 16px; height: 16px; }
.search-input {
  width: 100%; background: var(--navy-card); border: 1px solid var(--navy-border);
  border-radius: 10px; padding: 10px 12px 10px 36px;
  color: var(--text); font-family: 'DM Sans', sans-serif; font-size: 14px;
  outline: none;
}
.search-input:focus { border-color: var(--gold); }
.search-input::placeholder { color: var(--text-muted); }

.filter-chips { display: flex; gap: 8px; padding: 0 20px 12px; overflow-x: auto; }
.filter-chips::-webkit-scrollbar { display: none; }
.chip {
  flex-shrink: 0; padding: 6px 14px; border-radius: 20px;
  border: 1px solid var(--navy-border); background: transparent;
  color: var(--text-muted); font-family: 'DM Sans', sans-serif;
  font-size: 12px; font-weight: 500; cursor: pointer; transition: all 0.15s;
}
.chip.active { background: var(--gold); border-color: var(--gold); color: var(--navy); font-weight: 600; }

.leads-list { padding: 0 20px 20px; display: flex; flex-direction: column; gap: 8px; }

.lead-card {
  background: var(--navy-card); border: 1px solid var(--navy-border);
  border-radius: 14px; padding: 14px 16px; cursor: pointer;
  transition: border-color 0.2s; display: flex; align-items: center; gap: 12px;
}
.lead-card:active { border-color: var(--gold); }
.lead-avatar {
  width: 44px; height: 44px; border-radius: 50%; background: var(--navy-border);
  display: flex; align-items: center; justify-content: center;
  font-family: 'DM Serif Display', serif; font-size: 18px; color: var(--gold);
  flex-shrink: 0;
}
.lead-info { flex: 1; min-width: 0; }
.lead-name { font-weight: 600; font-size: 15px; }
.lead-meta { font-size: 12px; color: var(--text-muted); margin-top: 3px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.lead-right { display: flex; flex-direction: column; align-items: flex-end; gap: 6px; flex-shrink: 0; }

.status-badge {
  padding: 3px 10px; border-radius: 20px; font-size: 10px;
  font-weight: 700; letter-spacing: 0.5px; text-transform: uppercase;
}
.status-new { background: rgba(91,140,239,0.15); color: var(--blue); }
.status-warm { background: rgba(245,166,35,0.15); color: var(--amber); }
.status-hot { background: rgba(224,92,92,0.15); color: var(--red); }
.status-cold { background: rgba(136,146,170,0.15); color: var(--text-muted); }
.status-contacted { background: rgba(76,175,125,0.15); color: var(--green); }
.status-converted { background: rgba(155,110,245,0.15); color: var(--purple); }
.status-lost { background: rgba(136,146,170,0.1); color: var(--text-muted); }

.priority-dot { width: 8px; height: 8px; border-radius: 50%; }
.priority-high { background: var(--red); }
.priority-medium { background: var(--amber); }
.priority-low { background: var(--green); }

/* ‚îÄ‚îÄ ADD LEAD FORM ‚îÄ‚îÄ */
.form-screen { padding: 16px 20px 40px; }
.form-title { font-family: 'DM Serif Display', serif; font-size: 24px; color: var(--gold); margin-bottom: 4px; }
.form-subtitle { font-size: 13px; color: var(--text-muted); margin-bottom: 24px; }

.form-section { margin-bottom: 20px; }
.form-section-title {
  font-size: 10px; font-weight: 700; letter-spacing: 1px; text-transform: uppercase;
  color: var(--text-muted); margin-bottom: 10px; padding-left: 2px;
}

.field { margin-bottom: 12px; }
.field label { display: block; font-size: 12px; color: var(--text-muted); margin-bottom: 5px; font-weight: 500; }
.field input, .field select, .field textarea {
  width: 100%; background: var(--navy-card); border: 1px solid var(--navy-border);
  border-radius: 10px; padding: 11px 14px;
  color: var(--text); font-family: 'DM Sans', sans-serif; font-size: 14px;
  outline: none; transition: border-color 0.2s; appearance: none; -webkit-appearance: none;
}
.field input:focus, .field select:focus, .field textarea:focus { border-color: var(--gold); }
.field textarea { resize: none; height: 80px; }
.field select { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%238892aa' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 14px center; padding-right: 36px; }

.field-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }

.btn-primary {
  width: 100%; padding: 16px; background: var(--gold);
  border: none; border-radius: 12px; color: var(--navy);
  font-family: 'DM Sans', sans-serif; font-size: 15px; font-weight: 700;
  cursor: pointer; letter-spacing: 0.3px; transition: opacity 0.2s;
  margin-top: 8px;
}
.btn-primary:active { opacity: 0.85; }

.btn-secondary {
  width: 100%; padding: 14px; background: transparent;
  border: 1px solid var(--navy-border); border-radius: 12px; color: var(--text-muted);
  font-family: 'DM Sans', sans-serif; font-size: 14px; font-weight: 500;
  cursor: pointer; margin-top: 8px;
}

/* ‚îÄ‚îÄ LEAD DETAIL ‚îÄ‚îÄ */
.detail-screen {
  position: fixed; top: 0; left: 0; right: 0; bottom: 0;
  background: var(--navy); z-index: 100;
  transform: translateX(100%); transition: transform 0.3s cubic-bezier(0.4,0,0.2,1);
  display: flex; flex-direction: column; overflow: hidden;
}
.detail-screen.open { transform: translateX(0); }

.detail-header {
  padding: calc(var(--safe-top) + 14px) 20px 14px;
  background: var(--navy); border-bottom: 1px solid var(--navy-border);
  display: flex; align-items: center; gap: 12px;
}
.back-btn {
  width: 36px; height: 36px; border-radius: 50%; background: var(--navy-card);
  border: 1px solid var(--navy-border); display: flex; align-items: center; justify-content: center;
  cursor: pointer; flex-shrink: 0;
}
.detail-name { font-family: 'DM Serif Display', serif; font-size: 20px; color: var(--gold); flex: 1; }
.detail-actions { display: flex; gap: 8px; }
.action-btn {
  width: 36px; height: 36px; border-radius: 50%; background: var(--navy-card);
  border: 1px solid var(--navy-border); display: flex; align-items: center; justify-content: center;
  cursor: pointer; color: var(--text-muted); transition: color 0.2s, border-color 0.2s;
}
.action-btn:active { color: var(--gold); border-color: var(--gold); }

.detail-body { flex: 1; overflow-y: auto; padding: 20px; }

.detail-hero {
  background: var(--navy-card); border: 1px solid var(--navy-border);
  border-radius: 16px; padding: 20px; margin-bottom: 16px;
  display: flex; align-items: center; gap: 16px;
}
.detail-avatar {
  width: 56px; height: 56px; border-radius: 50%;
  background: linear-gradient(135deg, var(--navy-border), #2a3558);
  display: flex; align-items: center; justify-content: center;
  font-family: 'DM Serif Display', serif; font-size: 24px; color: var(--gold);
  flex-shrink: 0;
}
.detail-hero-info { flex: 1; }
.detail-company { font-size: 13px; color: var(--text-muted); margin-top: 4px; }
.detail-badges { display: flex; gap: 6px; margin-top: 8px; flex-wrap: wrap; }

.info-grid {
  background: var(--navy-card); border: 1px solid var(--navy-border);
  border-radius: 16px; padding: 16px; margin-bottom: 12px;
}
.info-grid-title { font-size: 11px; font-weight: 700; letter-spacing: 0.8px; text-transform: uppercase; color: var(--text-muted); margin-bottom: 14px; }
.info-row { display: flex; align-items: center; padding: 8px 0; border-bottom: 1px solid var(--navy-border); }
.info-row:last-child { border-bottom: none; }
.info-icon { width: 32px; height: 32px; border-radius: 8px; background: var(--navy-border); display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-right: 12px; }
.info-label { font-size: 12px; color: var(--text-muted); }
.info-value { font-size: 14px; font-weight: 500; margin-top: 1px; }
.info-link { color: var(--gold); text-decoration: none; }

.log-card {
  background: var(--navy-card); border: 1px solid var(--navy-border);
  border-radius: 12px; padding: 14px; margin-bottom: 10px;
}
.log-date { font-size: 11px; color: var(--text-muted); font-weight: 600; }
.log-outcome { font-size: 12px; margin-top: 4px; }
.log-notes { font-size: 13px; color: var(--text-muted); margin-top: 6px; line-height: 1.5; }

.log-form {
  background: var(--navy-card); border: 1px solid var(--gold);
  border-radius: 16px; padding: 16px; margin-bottom: 16px;
}
.log-form-title { font-size: 13px; font-weight: 600; color: var(--gold); margin-bottom: 12px; }

.quick-actions { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 16px; }
.quick-btn {
  background: var(--navy-card); border: 1px solid var(--navy-border);
  border-radius: 12px; padding: 12px 8px;
  color: var(--text); font-family: 'DM Sans', sans-serif; font-size: 11px;
  font-weight: 500; cursor: pointer; text-align: center;
  display: flex; flex-direction: column; align-items: center; gap: 6px;
  transition: border-color 0.2s; letter-spacing: 0.2px;
}
.quick-btn:active { border-color: var(--gold); }
.quick-btn svg { width: 20px; height: 20px; color: var(--gold); }

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
.toast {
  position: fixed; bottom: calc(var(--safe-bottom) + 70px); left: 50%; transform: translateX(-50%) translateY(20px);
  background: var(--navy-card); border: 1px solid var(--gold);
  border-radius: 10px; padding: 10px 20px;
  font-size: 13px; font-weight: 500; color: var(--gold);
  opacity: 0; transition: all 0.3s; z-index: 200; white-space: nowrap;
  pointer-events: none;
}
.toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

/* ‚îÄ‚îÄ FAB ‚îÄ‚îÄ */
.fab {
  position: fixed; right: 20px; bottom: calc(var(--safe-bottom) + 70px);
  width: 56px; height: 56px; border-radius: 50%;
  background: var(--gold); border: none;
  display: flex; align-items: center; justify-content: center;
  cursor: pointer; box-shadow: 0 4px 20px rgba(200,169,110,0.4);
  z-index: 50; transition: transform 0.2s;
}
.fab:active { transform: scale(0.93); }
.fab svg { width: 24px; height: 24px; color: var(--navy); }
.fab.hidden { display: none; }
</style>
</head>
<body>
<div id="app">
  <!-- TOP BAR -->
  <div class="top-bar">
    <div class="top-bar-inner">
      <div>
        <div class="app-title">üè† LandlordLeads</div>
        <div class="app-subtitle" id="topSubtitle">Cleriosan Property</div>
      </div>
      <div style="display:flex;gap:8px;align-items:center;">
        <div id="topDate" style="font-size:11px;color:var(--text-muted);text-align:right;"></div>
      </div>
    </div>
  </div>

  <!-- SCREENS -->
  <!-- DASHBOARD -->
  <div class="screen active" id="screen-dash">
    <div class="dash-header">
      <div class="greeting">Welcome back ‚Äî <strong id="greetDay">today</strong></div>
    </div>
    <div class="stats-grid" id="statsGrid"></div>
    <div class="section-header">
      <span class="section-title">Follow-ups Due</span>
      <span class="section-link" onclick="switchTab('leads')">View all ‚Üí</span>
    </div>
    <div class="followup-list" id="followupList"></div>
  </div>

  <!-- LEADS -->
  <div class="screen" id="screen-leads">
    <div class="search-bar">
      <div class="search-input-wrap">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
        <input class="search-input" id="searchInput" placeholder="Search by name, area, phone‚Ä¶" oninput="renderLeads()">
      </div>
    </div>
    <div class="filter-chips" id="filterChips"></div>
    <div class="leads-list" id="leadsList"></div>
  </div>

  <!-- ADD LEAD -->
  <div class="screen" id="screen-add">
    <div class="form-screen">
      <div class="form-title">New Lead</div>
      <div class="form-subtitle">Add a landlord you've just met</div>

      <div class="form-section">
        <div class="form-section-title">Contact</div>
        <div class="field"><label>Full Name *</label><input id="f_name" placeholder="e.g. John Smith"></div>
        <div class="field"><label>Company / Agency</label><input id="f_company" placeholder="Optional"></div>
        <div class="field-row">
          <div class="field"><label>Phone</label><input id="f_phone" type="tel" placeholder="+44‚Ä¶"></div>
          <div class="field"><label>Email</label><input id="f_email" type="email" placeholder="@email.com"></div>
        </div>
      </div>

      <div class="form-section">
        <div class="form-section-title">Property Details</div>
        <div class="field"><label>Area(s)</label><input id="f_area" placeholder="e.g. Hackney, Bethnal Green"></div>
        <div class="field-row">
          <div class="field"><label>No. of Properties</label><input id="f_props" type="number" placeholder="0" min="0"></div>
          <div class="field"><label>Property Type</label>
            <select id="f_type">
              <option value="">Select‚Ä¶</option>
              <option>Residential</option>
              <option>HMO</option>
              <option>Commercial</option>
              <option>Mixed</option>
              <option>Serviced</option>
            </select>
          </div>
        </div>
        <div class="field"><label>Motivation</label>
          <select id="f_motivation">
            <option value="">Select‚Ä¶</option>
            <option>Void issues</option>
            <option>Management issues</option>
            <option>Selling up</option>
            <option>Expanding</option>
            <option>Just networking</option>
            <option>Other</option>
          </select>
        </div>
      </div>

      <div class="form-section">
        <div class="form-section-title">Lead Management</div>
        <div class="field-row">
          <div class="field"><label>Status</label>
            <select id="f_status">
              <option value="New">New</option>
              <option value="Warm">Warm</option>
              <option value="Hot">Hot</option>
              <option value="Cold">Cold</option>
              <option value="Contacted">Contacted</option>
            </select>
          </div>
          <div class="field"><label>Priority</label>
            <select id="f_priority">
              <option value="Medium">Medium</option>
              <option value="High">High</option>
              <option value="Low">Low</option>
            </select>
          </div>
        </div>
        <div class="field-row">
          <div class="field"><label>Source / Event</label><input id="f_source" placeholder="e.g. BNI Meeting"></div>
          <div class="field"><label>Follow-up Date</label><input id="f_followup" type="date"></div>
        </div>
        <div class="field"><label>Notes</label><textarea id="f_notes" placeholder="Key points from the conversation‚Ä¶"></textarea></div>
      </div>

      <button class="btn-primary" onclick="saveLead()">Save Lead</button>
      <button class="btn-secondary" onclick="clearForm()">Clear Form</button>
    </div>
  </div>

  <!-- TAB BAR -->
  <div class="tab-bar">
    <button class="tab-btn active" id="tab-dash" onclick="switchTab('dash')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><rect x="3" y="3" width="7" height="7" rx="1.5"/><rect x="14" y="3" width="7" height="7" rx="1.5"/><rect x="3" y="14" width="7" height="7" rx="1.5"/><rect x="14" y="14" width="7" height="7" rx="1.5"/></svg>
      Dashboard
      <div class="tab-indicator"></div>
    </button>
    <button class="tab-btn" id="tab-leads" onclick="switchTab('leads')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
      Leads
      <div class="tab-indicator"></div>
    </button>
    <button class="tab-btn" id="tab-add" onclick="switchTab('add')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><circle cx="12" cy="12" r="9"/><path d="M12 8v8M8 12h8"/></svg>
      Add Lead
      <div class="tab-indicator"></div>
    </button>
  </div>
</div>

<!-- FAB for detail screen -->
<button class="fab hidden" id="fab" onclick="openLogForm()">
  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14,2 14,8 20,8"/><line x1="12" y1="18" x2="12" y2="12"/><line x1="9" y1="15" x2="15" y2="15"/></svg>
</button>

<!-- DETAIL SCREEN -->
<div class="detail-screen" id="detailScreen">
  <div class="detail-header">
    <div class="back-btn" onclick="closeDetail()">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 18l-6-6 6-6"/></svg>
    </div>
    <div class="detail-name" id="detailName">Lead</div>
    <div class="detail-actions">
      <div class="action-btn" id="callBtn" title="Call">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07A19.5 19.5 0 013.07 8.63a19.79 19.79 0 01-3-8.59A2 2 0 012 0h3a2 2 0 012 1.72c.127.96.361 1.903.7 2.81a2 2 0 01-.45 2.11L6.09 7.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0122 14.92z"/></svg>
      </div>
      <div class="action-btn" id="editLeadBtn" title="Edit" onclick="editCurrentLead()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
      </div>
    </div>
  </div>
  <div class="detail-body" id="detailBody"></div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<script>
// ‚îÄ‚îÄ DATA STORE ‚îÄ‚îÄ
const STORE_KEY = 'landlord_leads_v2';
let leads = JSON.parse(localStorage.getItem(STORE_KEY) || '[]');
let currentLeadId = null;
let activeFilter = 'All';
let editMode = false;
let logFormOpen = false;

function save() { localStorage.setItem(STORE_KEY, JSON.stringify(leads)); }

function genId() { return Date.now().toString(36) + Math.random().toString(36).substr(2,5); }

// ‚îÄ‚îÄ DATE HELPERS ‚îÄ‚îÄ
function today() { return new Date().toISOString().split('T')[0]; }
function formatDate(d) {
  if (!d) return '‚Äî';
  const parts = d.split('-');
  const dt = new Date(+parts[0], +parts[1]-1, +parts[2]);
  return dt.toLocaleDateString('en-GB', { day:'numeric', month:'short', year:'numeric' });
}
function daysUntil(d) {
  if (!d) return null;
  const t = new Date(today()); const f = new Date(d);
  return Math.round((f - t) / 86400000);
}
function dueBadge(d) {
  if (!d) return '';
  const n = daysUntil(d);
  if (n < 0) return `<span class="followup-due due-overdue">${Math.abs(n)}d overdue</span>`;
  if (n === 0) return `<span class="followup-due due-today">Today!</span>`;
  if (n <= 3) return `<span class="followup-due due-today">In ${n}d</span>`;
  return `<span class="followup-due due-upcoming">In ${n}d</span>`;
}

// ‚îÄ‚îÄ TABS ‚îÄ‚îÄ
function switchTab(tab) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('screen-' + tab).classList.add('active');
  document.getElementById('tab-' + tab).classList.add('active');
  document.getElementById('fab').classList.add('hidden');
  if (tab === 'dash') renderDash();
  if (tab === 'leads') renderLeads();
  if (tab === 'add') { if(!editMode) clearForm(); }
}

// ‚îÄ‚îÄ DASHBOARD ‚îÄ‚îÄ
function renderDash() {
  const now = new Date();
  document.getElementById('greetDay').textContent = now.toLocaleDateString('en-GB', {weekday:'long'});
  document.getElementById('topDate').textContent = now.toLocaleDateString('en-GB', {day:'numeric',month:'short'});

  const total = leads.length;
  const hot = leads.filter(l => l.status === 'Hot').length;
  const dueToday = leads.filter(l => l.followup === today()).length;
  const overdue = leads.filter(l => l.followup && daysUntil(l.followup) < 0).length;

  document.getElementById('statsGrid').innerHTML = `
    <div class="stat-card" style="--accent-color:var(--blue)">
      <div class="stat-label">Total Leads</div>
      <div class="stat-value">${total}</div>
      <div class="stat-sub">All pipeline</div>
    </div>
    <div class="stat-card" style="--accent-color:var(--red)">
      <div class="stat-label">Hot Leads</div>
      <div class="stat-value">${hot}</div>
      <div class="stat-sub">Priority now</div>
    </div>
    <div class="stat-card" style="--accent-color:var(--amber)">
      <div class="stat-label">Due Today</div>
      <div class="stat-value">${dueToday}</div>
      <div class="stat-sub">Follow-ups</div>
    </div>
    <div class="stat-card" style="--accent-color:var(--red)">
      <div class="stat-label">Overdue</div>
      <div class="stat-value">${overdue}</div>
      <div class="stat-sub">Need action</div>
    </div>
  `;

  const due = leads
    .filter(l => l.followup && daysUntil(l.followup) <= 7)
    .sort((a,b) => (daysUntil(a.followup)||999) - (daysUntil(b.followup)||999))
    .slice(0, 8);

  if (!due.length) {
    document.getElementById('followupList').innerHTML = `<div class="empty-state"><div class="icon">‚úÖ</div><p>No follow-ups due this week</p></div>`;
    return;
  }

  document.getElementById('followupList').innerHTML = due.map(l => `
    <div class="followup-card" onclick="openDetail('${l.id}')">
      <div class="followup-avatar">${l.name[0].toUpperCase()}</div>
      <div class="followup-info">
        <div class="followup-name">${l.name}</div>
        <div class="followup-meta">${l.area || '‚Äî'} ¬∑ ${l.props ? l.props+' props' : 'props TBC'}</div>
      </div>
      <div style="text-align:right">
        <div class="${statusClass(l.status)} status-badge">${l.status}</div>
        <div style="margin-top:6px">${dueBadge(l.followup)}</div>
      </div>
    </div>
  `).join('');
}

// ‚îÄ‚îÄ LEADS ‚îÄ‚îÄ
const STATUSES = ['All','New','Warm','Hot','Contacted','Cold','Converted','Lost'];

function renderFilterChips() {
  document.getElementById('filterChips').innerHTML = STATUSES.map(s =>
    `<div class="chip ${s===activeFilter?'active':''}" onclick="setFilter('${s}')">${s}</div>`
  ).join('');
}

function setFilter(s) { activeFilter = s; renderFilterChips(); renderLeads(); }

function statusClass(s) {
  const m = {New:'status-new',Warm:'status-warm',Hot:'status-hot',Cold:'status-cold',Contacted:'status-contacted',Converted:'status-converted',Lost:'status-lost'};
  return m[s] || 'status-new';
}
function priorityClass(p) {
  return p === 'High' ? 'priority-high' : p === 'Low' ? 'priority-low' : 'priority-medium';
}

function renderLeads() {
  renderFilterChips();
  const q = (document.getElementById('searchInput')?.value || '').toLowerCase();
  let filtered = leads.filter(l => {
    const matchFilter = activeFilter === 'All' || l.status === activeFilter;
    const matchQ = !q || l.name?.toLowerCase().includes(q) || l.area?.toLowerCase().includes(q) || l.phone?.includes(q) || l.company?.toLowerCase().includes(q);
    return matchFilter && matchQ;
  }).sort((a,b) => {
    const po = {High:0,Medium:1,Low:2};
    return (po[a.priority]||1) - (po[b.priority]||1) || b.added.localeCompare(a.added);
  });

  if (!filtered.length) {
    document.getElementById('leadsList').innerHTML = `<div class="empty-state"><div class="icon">üîç</div><p>No leads found</p></div>`;
    return;
  }

  document.getElementById('leadsList').innerHTML = filtered.map(l => `
    <div class="lead-card" onclick="openDetail('${l.id}')">
      <div class="lead-avatar">${l.name[0].toUpperCase()}</div>
      <div class="lead-info">
        <div class="lead-name">${l.name}</div>
        <div class="lead-meta">${[l.area, l.props ? l.props+' props' : null, l.type].filter(Boolean).join(' ¬∑ ') || 'No details yet'}</div>
      </div>
      <div class="lead-right">
        <span class="status-badge ${statusClass(l.status)}">${l.status}</span>
        <div class="priority-dot ${priorityClass(l.priority)}"></div>
        ${l.followup ? `<div style="font-size:11px;color:var(--text-muted)">${dueBadge(l.followup)}</div>` : ''}
      </div>
    </div>
  `).join('');
}

// ‚îÄ‚îÄ ADD / EDIT LEAD ‚îÄ‚îÄ
function clearForm() {
  editMode = false; currentLeadId = null;
  ['f_name','f_company','f_phone','f_email','f_area','f_source','f_notes'].forEach(id => {
    const el = document.getElementById(id); if(el) el.value = '';
  });
  ['f_props'].forEach(id => { const el = document.getElementById(id); if(el) el.value = ''; });
  document.getElementById('f_status').value = 'New';
  document.getElementById('f_priority').value = 'Medium';
  document.getElementById('f_type').value = '';
  document.getElementById('f_motivation').value = '';
  document.getElementById('f_followup').value = '';
  document.querySelector('#screen-add .form-title').textContent = 'New Lead';
  document.querySelector('#screen-add .form-subtitle').textContent = "Add a landlord you've just met";
}

function saveLead() {
  const name = document.getElementById('f_name').value.trim();
  if (!name) { showToast('Please enter a name'); return; }

  const lead = {
    id: editMode ? currentLeadId : genId(),
    name, added: editMode ? (leads.find(l=>l.id===currentLeadId)?.added || today()) : today(),
    company: document.getElementById('f_company').value.trim(),
    phone: document.getElementById('f_phone').value.trim(),
    email: document.getElementById('f_email').value.trim(),
    area: document.getElementById('f_area').value.trim(),
    props: document.getElementById('f_props').value.trim(),
    type: document.getElementById('f_type').value,
    motivation: document.getElementById('f_motivation').value,
    status: document.getElementById('f_status').value,
    priority: document.getElementById('f_priority').value,
    source: document.getElementById('f_source').value.trim(),
    followup: document.getElementById('f_followup').value,
    notes: document.getElementById('f_notes').value.trim(),
    log: editMode ? (leads.find(l=>l.id===currentLeadId)?.log || []) : []
  };

  if (editMode) {
    leads = leads.map(l => l.id === currentLeadId ? lead : l);
    showToast('Lead updated ‚úì');
    closeDetail();
    openDetail(lead.id);
  } else {
    leads.unshift(lead);
    showToast('Lead saved ‚úì');
    clearForm();
    switchTab('dash');
  }
  save(); renderDash(); renderLeads();
}

// ‚îÄ‚îÄ DETAIL ‚îÄ‚îÄ
function openDetail(id) {
  currentLeadId = id;
  const l = leads.find(x => x.id === id);
  if (!l) return;
  document.getElementById('detailName').textContent = l.name;
  document.getElementById('callBtn').onclick = l.phone ? () => window.open('tel:'+l.phone) : null;
  document.getElementById('callBtn').style.opacity = l.phone ? '1' : '0.4';
  renderDetailBody(l);
  document.getElementById('detailScreen').classList.add('open');
  document.getElementById('fab').classList.remove('hidden');
  logFormOpen = false;
}

function renderDetailBody(l) {
  const doc = document.getElementById('detailBody');
  doc.innerHTML = `
    <div class="detail-hero">
      <div class="detail-avatar">${l.name[0].toUpperCase()}</div>
      <div class="detail-hero-info">
        <div style="font-weight:600;font-size:17px">${l.name}</div>
        ${l.company ? `<div class="detail-company">${l.company}</div>` : ''}
        <div class="detail-badges">
          <span class="status-badge ${statusClass(l.status)}">${l.status}</span>
          <span class="status-badge" style="background:rgba(200,169,110,0.12);color:var(--gold)">
            ${l.priority} Priority
          </span>
        </div>
      </div>
    </div>

    <!-- Quick actions -->
    <div class="quick-actions">
      ${l.phone ? `<button class="quick-btn" onclick="window.open('tel:${l.phone}')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07A19.5 19.5 0 013.07 8.63a19.79 19.79 0 01-3-8.59A2 2 0 012 0h3a2 2 0 012 1.72c.127.96.361 1.903.7 2.81a2 2 0 01-.45 2.11L6.09 7.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0122 14.92z"/></svg>
        Call
      </button>` : `<button class="quick-btn" style="opacity:0.4;cursor:default">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07A19.5 19.5 0 013.07 8.63a19.79 19.79 0 01-3-8.59A2 2 0 012 0h3a2 2 0 012 1.72c.127.96.361 1.903.7 2.81a2 2 0 01-.45 2.11L6.09 7.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0122 14.92z"/></svg>
        Call
      </button>`}
      ${l.phone ? `<button class="quick-btn" onclick="window.open('sms:${l.phone}')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg>
        Text
      </button>` : `<button class="quick-btn" style="opacity:0.4;cursor:default">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg>
        Text
      </button>`}
      ${l.email ? `<button class="quick-btn" onclick="window.open('mailto:${l.email}')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
        Email
      </button>` : `<button class="quick-btn" style="opacity:0.4;cursor:default">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
        Email
      </button>`}
    </div>

    <!-- Contact info -->
    <div class="info-grid">
      <div class="info-grid-title">Contact Details</div>
      ${infoRow('üìû', 'Phone', l.phone ? `<a class="info-link" href="tel:${l.phone}">${l.phone}</a>` : '‚Äî')}
      ${infoRow('‚úâÔ∏è', 'Email', l.email ? `<a class="info-link" href="mailto:${l.email}">${l.email}</a>` : '‚Äî')}
      ${infoRow('üè¢', 'Company', l.company || '‚Äî')}
      ${infoRow('üìç', 'Area', l.area || '‚Äî')}
    </div>

    <!-- Property info -->
    <div class="info-grid">
      <div class="info-grid-title">Property Details</div>
      ${infoRow('üè†', 'No. Properties', l.props || '‚Äî')}
      ${infoRow('üèóÔ∏è', 'Property Type', l.type || '‚Äî')}
      ${infoRow('üí°', 'Motivation', l.motivation || '‚Äî')}
      ${infoRow('üì£', 'Source', l.source || '‚Äî')}
    </div>

    <!-- Follow-up -->
    <div class="info-grid">
      <div class="info-grid-title">Follow-up</div>
      ${infoRow('üìÖ', 'Date Added', formatDate(l.added))}
      ${infoRow('üîî', 'Next Follow-up', `${formatDate(l.followup)} ${l.followup ? dueBadge(l.followup) : ''}`)}
      ${infoRow('üî¢', 'Total Logs', (l.log?.length || 0) + ' entries')}
    </div>

    ${l.notes ? `<div class="info-grid"><div class="info-grid-title">Notes</div><p style="font-size:14px;color:var(--text-muted);line-height:1.6">${l.notes}</p></div>` : ''}

    <!-- Log form placeholder -->
    <div id="logFormArea"></div>

    <!-- Activity log -->
    <div class="section-header" style="padding:12px 0 8px">
      <span class="section-title">Activity Log</span>
    </div>
    ${(l.log||[]).length === 0
      ? `<div class="empty-state" style="padding:20px 0"><div class="icon">üìã</div><p>No activity logged yet</p></div>`
      : [...(l.log||[])].reverse().map(entry => `
        <div class="log-card">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div class="log-date">${formatDate(entry.date)}</div>
            <span style="font-size:11px;background:rgba(200,169,110,0.12);color:var(--gold);padding:2px 8px;border-radius:10px">${entry.method||'‚Äî'}</span>
          </div>
          ${entry.outcome ? `<div class="log-outcome">Outcome: <strong>${entry.outcome}</strong></div>` : ''}
          ${entry.notes ? `<div class="log-notes">${entry.notes}</div>` : ''}
          ${entry.nextFollowup ? `<div style="font-size:11px;color:var(--amber);margin-top:6px">üìÖ Next: ${formatDate(entry.nextFollowup)}</div>` : ''}
        </div>
      `).join('')}

    <div style="height:20px"></div>
  `;
}

function infoRow(icon, label, value) {
  return `<div class="info-row">
    <div class="info-icon">${icon}</div>
    <div style="flex:1">
      <div class="info-label">${label}</div>
      <div class="info-value">${value}</div>
    </div>
  </div>`;
}

function closeDetail() {
  document.getElementById('detailScreen').classList.remove('open');
  document.getElementById('fab').classList.add('hidden');
  currentLeadId = null;
  logFormOpen = false;
}

function editCurrentLead() {
  const l = leads.find(x => x.id === currentLeadId);
  if (!l) return;
  editMode = true;
  document.getElementById('f_name').value = l.name || '';
  document.getElementById('f_company').value = l.company || '';
  document.getElementById('f_phone').value = l.phone || '';
  document.getElementById('f_email').value = l.email || '';
  document.getElementById('f_area').value = l.area || '';
  document.getElementById('f_props').value = l.props || '';
  document.getElementById('f_type').value = l.type || '';
  document.getElementById('f_motivation').value = l.motivation || '';
  document.getElementById('f_status').value = l.status || 'New';
  document.getElementById('f_priority').value = l.priority || 'Medium';
  document.getElementById('f_source').value = l.source || '';
  document.getElementById('f_followup').value = l.followup || '';
  document.getElementById('f_notes').value = l.notes || '';
  document.querySelector('#screen-add .form-title').textContent = 'Edit Lead';
  document.querySelector('#screen-add .form-subtitle').textContent = 'Update ' + l.name + "'s details";
  closeDetail();
  switchTab('add');
}

// ‚îÄ‚îÄ LOG FOLLOW-UP ‚îÄ‚îÄ
function openLogForm() {
  if (logFormOpen) return;
  logFormOpen = true;
  const area = document.getElementById('logFormArea');
  area.innerHTML = `
    <div class="log-form">
      <div class="log-form-title">üìù Log Follow-up</div>
      <div class="field">
        <label>Date</label>
        <input id="lf_date" type="date" value="${today()}">
      </div>
      <div class="field-row">
        <div class="field"><label>Method</label>
          <select id="lf_method">
            <option>Phone Call</option>
            <option>Text / WhatsApp</option>
            <option>Email</option>
            <option>In Person</option>
            <option>Social Media</option>
          </select>
        </div>
        <div class="field"><label>Outcome</label>
          <select id="lf_outcome">
            <option>Positive</option>
            <option>Neutral</option>
            <option>No Response</option>
            <option>Not Interested</option>
            <option>Converted</option>
            <option>Callback Requested</option>
          </select>
        </div>
      </div>
      <div class="field"><label>Notes</label><textarea id="lf_notes" placeholder="What was discussed‚Ä¶"></textarea></div>
      <div class="field-row">
        <div class="field"><label>Update Status</label>
          <select id="lf_status">
            <option value="">No change</option>
            <option>New</option><option>Warm</option><option>Hot</option>
            <option>Cold</option><option>Contacted</option><option>Converted</option><option>Lost</option>
          </select>
        </div>
        <div class="field"><label>Next Follow-up</label><input id="lf_nextdate" type="date"></div>
      </div>
      <button class="btn-primary" onclick="saveLog()">Save Log Entry</button>
      <button class="btn-secondary" onclick="cancelLog()">Cancel</button>
    </div>
  `;
  area.scrollIntoView({ behavior: 'smooth', block: 'start' });
}

function cancelLog() {
  document.getElementById('logFormArea').innerHTML = '';
  logFormOpen = false;
}

function saveLog() {
  const l = leads.find(x => x.id === currentLeadId);
  if (!l) return;
  const entry = {
    date: document.getElementById('lf_date').value,
    method: document.getElementById('lf_method').value,
    outcome: document.getElementById('lf_outcome').value,
    notes: document.getElementById('lf_notes').value.trim(),
    nextFollowup: document.getElementById('lf_nextdate').value
  };
  if (!l.log) l.log = [];
  l.log.push(entry);
  const newStatus = document.getElementById('lf_status').value;
  if (newStatus) l.status = newStatus;
  if (entry.nextFollowup) l.followup = entry.nextFollowup;
  save();
  showToast('Follow-up logged ‚úì');
  renderDetailBody(l);
  document.getElementById('detailName').textContent = l.name;
  logFormOpen = false;
  renderDash(); renderLeads();
}

// ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2500);
}

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ
renderDash();
renderLeads();
document.getElementById('f_followup').value = '';
// Set default follow-up to tomorrow
const tm = new Date(); tm.setDate(tm.getDate()+1);
document.getElementById('f_followup').value = tm.toISOString().split('T')[0];
</script>
</body>
</html>
